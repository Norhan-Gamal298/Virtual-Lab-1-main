
# 7.4 Color Segmentation

<video width="800" height="410" controls>
    <source src="photows/FundamentalsofColoImageProcessing.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video

---

##  Introduction
- Segmentation based on color similarity (e.g., HSV thresholding).


##  HSV Thresholding

### Condition:

\[
H_{min} \leq H \leq H_{max}, S_{min} \leq S \leq S_{max}, V_{min} \leq V \leq V_{max}
\]

---

###  Python Code

```python
# Import OpenCV for image processing
import cv2
# Import NumPy for numerical computations
import numpy as np
# Import Matplotlib for image visualization
import matplotlib.pyplot as plt

# Load the image from file
img = cv2.imread('sample.jpg')  # Load 'sample.jpg' image

# Check if image is loaded correctly
if img is None:
    raise FileNotFoundError("Image not found. Please check the file path.")

# Resize the image to half of its original dimensions
resized = cv2.resize(img, (img.shape[1] // 2, img.shape[0] // 2))

# Convert image from BGR to YCbCr color space
ycbcr = cv2.cvtColor(resized, cv2.COLOR_BGR2YCrCb)

# Split the YCbCr image into individual channels
y, cr, cb = cv2.split(ycbcr)

# Enhance the brightness and contrast by equalizing the Y (luminance) channel
y_eq = cv2.equalizeHist(y)

# Merge the equalized Y channel with original Cr and Cb channels
ycbcr_eq = cv2.merge([y_eq, cr, cb])

# Define threshold ranges for Cr and Cb to segment a specific color region
cr_min, cr_max = 135, 180  # Threshold range for Cr
cb_min, cb_max = 85, 135   # Threshold range for Cb

# Create a binary mask using the defined Cr and Cb thresholds
mask = cv2.inRange(ycbcr_eq, (0, cr_min, cb_min), (255, cr_max, cb_max))

# Apply the mask to the original resized image to extract the segmented region
segmented = cv2.bitwise_and(resized, resized, mask=mask)

# Convert images from BGR to RGB for correct display using Matplotlib
resized_rgb = cv2.cvtColor(resized, cv2.COLOR_BGR2RGB)
segmented_rgb = cv2.cvtColor(segmented, cv2.COLOR_BGR2RGB)

# Display the original, equalized Y channel, and segmented image side-by-side
plt.figure(figsize=(15, 5))

# Show original resized image
plt.subplot(1, 3, 1)
plt.imshow(resized_rgb)
plt.title('Original Resized Image')
plt.axis('off')

# Show equalized Y channel in grayscale
plt.subplot(1, 3, 2)
plt.imshow(y_eq, cmap='gray')
plt.title('Equalized Luminance (Y) Channel')
plt.axis('off')

# Show segmented image using YCbCr thresholding
plt.subplot(1, 3, 3)
plt.imshow(segmented_rgb)
plt.title('Segmented Image by YCbCr Thresholding')
plt.axis('off')

# Adjust layout and display all plots
plt.tight_layout()
plt.show()


```


###  MATLAB Code

```matlab
% Read the image from file
img = imread('sample.jpg'); % Load 'sample.jpg' image

% Check if the image is loaded correctly
if isempty(img)
    error('Image not found. Please check the file path.');
end

% Resize the image to half of its original size
resized = imresize(img, 0.5); % Resize image to 50%

% Convert the image from RGB to YCbCr color space
ycbcr = rgb2ycbcr(resized);

% Extract individual channels
y = ycbcr(:,:,1);
cb = ycbcr(:,:,2);
cr = ycbcr(:,:,3);

% Equalize the luminance channel (Y channel) to enhance contrast
y_eq = histeq(y);

% Merge the equalized Y channel with original Cr and Cb channels
ycbcr_eq = cat(3, y_eq, cb, cr);

% Define threshold ranges for Cr and Cb to segment color
cr_min = 135;
cr_max = 180;
cb_min = 85;
cb_max = 135;

% Create a binary mask based on the thresholds for Cr and Cb channels
mask = (ycbcr_eq(:,:,3) >= cr_min) & (ycbcr_eq(:,:,3) <= cr_max) & ...
       (ycbcr_eq(:,:,2) >= cb_min) & (ycbcr_eq(:,:,2) <= cb_max);

% Apply the mask to the resized image to extract segmented region
segmented = bsxfun(@times, resized, cast(mask, 'like', resized));

% Display the results
figure;

% Show original resized image
subplot(1,3,1);
imshow(resized);
title('Original Resized Image');

% Show equalized luminance channel
subplot(1,3,2);
imshow(y_eq);
title('Equalized Luminance (Y) Channel');

% Show segmented image
subplot(1,3,3);
imshow(segmented);
title('Segmented Image by YCbCr Thresholding');

```
###  Image
![alt](photows/ColorSegmentation_1.png)